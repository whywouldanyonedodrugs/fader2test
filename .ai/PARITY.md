# Parity contract (FADER2)

Authoritative invariant: `upstream_longonly` is the frozen reference. `shortonly` must match it on CANARY until we intentionally diverge.

## Canary scope
- Data: `data_canary/` generated by `tools/make_canary_from_lake.py`
- Symbols: `symbols_canary.txt`
- Window: fixed ISO start/end used to generate canary
- Outputs:
  - signals: `reports/upstream_signals/` and `reports/shortonly_signals/`
  - results: `reports/upstream_results/` and `reports/shortonly_results/`

## Baseline artifact (tracked)
- `Docs/baselines/BASELINE_UPSTREAM_CANARY.json` is committed and defines the reference fingerprints.

## Acceptance rule
A change is acceptable only if:
1) `tools/run_upstream_canary.py` succeeds, and
2) `tools/run_shortonly_canary.py` succeeds, and
3) `tools/compare_upstream_shortonly_canary.py` returns OK,
4) and if upstream baseline is intended to remain stable, upstream fingerprints match the committed baseline JSON.

## If it fails
- Do not change upstream to “make it pass” unless fixing a proven bug that exists in upstream itself.
- Diagnose by diffing: signals rows/fp → trades rows/fp → equity fp → RS fp → lock fp.
- Any fix must be minimal, anchored, and verified by rerunning the canary.

## Local gate requirement (process rule)
- The acceptance evidence must come from a local run on the data machine (where data_canary exists).
- CI (including a self-hosted runner) may mirror the same checks, but does not waive the local gate requirement.
